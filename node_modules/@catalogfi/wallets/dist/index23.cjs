"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const T=require("bip32"),S=require("bip39"),u=require("bitcoinjs-lib"),j=require("tiny-secp256k1"),l=require("./index19.cjs"),b=require("./index8.cjs"),k=require("./index14.cjs");function w(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const n in t)if(n!=="default"){const o=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,o.get?o:{enumerable:!0,get:()=>t[n]})}}return e.default=t,Object.freeze(e)}const y=w(S),v=w(j),O={p2pk:l.BitcoinPaths.bip44,p2pkh:l.BitcoinPaths.bip44,"p2wpkh-p2sh":l.BitcoinPaths.bip49,p2wpkh:l.BitcoinPaths.bip84};function m(t){return{[b.BitcoinNetwork.Mainnet]:u.networks.bitcoin,[b.BitcoinNetwork.Testnet]:u.networks.testnet,[b.BitcoinNetwork.Regtest]:u.networks.regtest}[t]}function h(t,e,n,o,s){const r=m(s.getNetwork()),i=O[t],a=i(s.getNetwork(),e,n),c=o.derivePath(a);let p;return t.split("-").length>1?p=u.payments.p2sh({network:r,redeem:u.payments.p2wpkh({network:r,pubkey:c.publicKey})}).address:p=u.payments[t]({network:r,pubkey:c.publicKey}).address,{address:p,privateKey:c.privateKey?.toString("hex")||"",type:t,path:a}}function q(t,e,n,o,s){const r=[];for(let i=e;i<n;i++)for(const a of Object.values(k.AddressType)){const{address:c,type:p,path:d,privateKey:N}=h(a,i,t,o,s),B=new Promise((P,A)=>{s.getTransactions(c,b.BitcoinTxType.ALL).then(g=>P({address:c,path:d,type:p,privateKey:N,transactions:g})).catch(g=>A(g))});r.push(B)}return r}const f=(t,e)=>{if(!y.validateMnemonic(t))throw new Error("Invalid mnemonic");const n=y.mnemonicToSeedSync(t);return T.BIP32Factory(v).fromSeed(n,m(e))},_=(t,e,n=0)=>{const o=f(t,e.getNetwork());return Object.values(k.AddressType).map(s=>h(s,0,n,o,e))},K=(t,e,n,o=0)=>{const s=f(t,e.getNetwork());return h(n,0,o,s,e)},x=async(t,e)=>{const n=f(t,e.getNetwork()),o=20;let s=[];for(let r=0;;r++){const i=[];let a=0;for(let c=0;a<=o;c+=o){const p=await Promise.all(q(r,c,c+o,n,e));for(const d of p)d.transactions.length===0?a++:(i.push(d),a>0&&(a=0))}if(i.length===0)break;s.push(...i)}return s};exports.discover=x;exports.generateRootNode=f;exports.getAccount=K;exports.getInitialAccounts=_;
