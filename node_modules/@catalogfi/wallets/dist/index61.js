import{encodeAbiParameters as m}from"./index90.js";import{concat as l}from"./index76.js";import{toHex as c}from"./index42.js";import{keccak256 as n}from"./index59.js";import{getTypesForEIP712Domain as b,validateTypedData as D}from"./index91.js";function x(r){const{domain:a={},message:t,primaryType:e}=r,y={EIP712Domain:b({domain:a}),...r.types};D({domain:a,message:t,primaryType:e,types:y});const p=["0x1901"];return a&&p.push(u({domain:a,types:y})),e!=="EIP712Domain"&&p.push(i({data:t,primaryType:e,types:y})),n(l(p))}function u({domain:r,types:a}){return i({data:r,primaryType:"EIP712Domain",types:a})}function i({data:r,primaryType:a,types:t}){const e=f({data:r,primaryType:a,types:t});return n(e)}function f({data:r,primaryType:a,types:t}){const e=[{type:"bytes32"}],y=[g({primaryType:a,types:t})];for(const p of t[a]){const[s,o]=h({types:t,name:p.name,type:p.type,value:r[p.name]});e.push(s),y.push(o)}return m(e,y)}function g({primaryType:r,types:a}){const t=c(d({primaryType:r,types:a}));return n(t)}function d({primaryType:r,types:a}){let t="";const e=T({primaryType:r,types:a});e.delete(r);const y=[r,...Array.from(e).sort()];for(const p of y)t+=`${p}(${a[p].map(({name:s,type:o})=>`${o} ${s}`).join(",")})`;return t}function T({primaryType:r,types:a},t=new Set){var y;const e=(y=r.match(/^\w*/u))==null?void 0:y[0];if(t.has(e)||a[e]===void 0)return t;t.add(e);for(const p of a[e])T({primaryType:p.type,types:a},t);return t}function h({types:r,name:a,type:t,value:e}){if(r[t]!==void 0)return[{type:"bytes32"},n(f({data:e,primaryType:t,types:r}))];if(t==="bytes")return e=`0x${(e.length%2?"0":"")+e.slice(2)}`,[{type:"bytes32"},n(e)];if(t==="string")return[{type:"bytes32"},n(c(e))];if(t.lastIndexOf("]")===t.length-1){const y=t.slice(0,t.lastIndexOf("[")),p=e.map(s=>h({name:a,type:y,types:r,value:s}));return[{type:"bytes32"},n(m(p.map(([s])=>s),p.map(([,s])=>s)))]}return[{type:t},e]}export{d as encodeType,u as hashDomain,i as hashStruct,x as hashTypedData};
