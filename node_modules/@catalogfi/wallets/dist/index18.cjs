"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("@catalogfi/utils"),y=require("bip39"),b=require("./index27.cjs"),P=require("./index28.cjs");function T(s){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(s){for(const e in s)if(e!=="default"){const n=Object.getOwnPropertyDescriptor(s,e);Object.defineProperty(t,e,n.get?n:{enumerable:!0,get:()=>s[e]})}}return t.default=s,Object.freeze(t)}const K=T(y);class v{constructor(t){this.endpoint=t}async getTransactions(t){for(let r=1;r<=10;r++){const a=await this._getTransactions(t);if(typeof a.result!="string")return a.result;await l.sleep(1e3*r)}throw new Error("Unable to fetch transactions.")}async _getTransactions(t){try{const e=new URL(this.endpoint);return e.searchParams.append("module","account"),e.searchParams.append("address",t),e.searchParams.append("startblock","0"),e.searchParams.append("endblock","latest"),e.searchParams.append("offset","1"),e.searchParams.append("action","txlist"),await l.Fetcher.get(e)}catch(e){return{status:"0",message:e.message,result:"Failed to fetch transactions"}}}}const x=(s,t)=>`m/44'/60'/${s}'/0/${t}`,m=(s,t,e)=>{const n=x(t,s),r=P.hdKeyToAccount(e,{path:n});return{address:r.address,path:n,publicKey:r.publicKey,privateKey:"0x"+Buffer.from(l.ensureVal(r.getHdKey().privateKey,"HDKey doesn't have a private key")).toString("hex")}},S=(s,t,e,n,r)=>{const a=[];for(let o=t;o<e;o++){const{address:c,path:i,privateKey:d}=m(o,s,n),p=new Promise((u,g)=>{r.getTransactions(c).then(h=>u({address:c,path:i,privateKey:d,transactions:h})).catch(h=>g(h))});a.push(p)}return a},f=s=>b.HDKey.fromMasterSeed(K.mnemonicToSeedSync(s)),w=async(s,t)=>{const r=f(s);let a=[];for(let o=0;;o++){const c=[];let i=0;for(let d=0;i<=20;d+=5){const p=await Promise.all(S(o,d,d+5,r,t));await l.sleep(1500);for(const u of p)u.transactions.length===0?i++:(c.push(u),i>0&&(i=0))}if(c.length===0)break;a.push(...c)}return a};exports.EtherscanTxProvider=v;exports.discover=w;exports.generateRootNode=f;exports.getKeysFromAddress=m;
