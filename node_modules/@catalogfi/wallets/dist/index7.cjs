"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const p=require("@catalogfi/extension"),a=require("bitcoinjs-lib"),n=require("yup"),f=require("./index5.cjs"),i=require("./index8.cjs"),v=require("./index10.cjs"),u=require("./index12.cjs"),r={getAddress:"btc_getAddress",getBalance:"btc_getBalance",getPublicKey:"btc_getPublicKey",getNetwork:"btc_getNetwork",getWalletConfig:"btc_getWalletConfig",sign:"btc_sign",send:"btc_send",spend:"btc_spend"};class d extends f.AbstractBitcoinWallet{constructor(t){super(),this.connector=t}static async detect(){const t=new p.Connector;return new d(t)}async getBalance(){const t=await this.connector.send(r.getBalance);return await n.number().required().validate(t)}async getPublicKey(){const t=await this.connector.send(r.getPublicKey);return await n.string().required().validate(t)}async getProviderNetwork(){const t=await this.connector.send(r.getNetwork);return n.mixed().oneOf([i.BitcoinNetwork.Mainnet,i.BitcoinNetwork.Testnet,i.BitcoinNetwork.Regtest]).required().validate(t)}async getNetwork(){const t=await this.getProviderNetwork();if(t===i.BitcoinNetwork.Mainnet)return a.networks.bitcoin;if(t===i.BitcoinNetwork.Testnet)return a.networks.testnet;if(t===i.BitcoinNetwork.Regtest)return a.networks.regtest;throw new Error("Invalid network from catalog wallet")}async getProvider(){const t=await this.getProviderNetwork();return new v.BitcoinProvider(t)}signSchnorr(t){throw new Error("signSchnorr: Method not supported")}async send(t,o,s){const c=await this.connector.send(r.send,{toAddress:t,amt:o,fee:s});return await n.string().required().validate(c)}async spend(t,o,{toAddress:s,fee:c,nSequence:g,unlockScript:l,witness:w}){const b=w?.map(e=>e instanceof u.AddSignature?e.toString():e.toString("hex")),h=l?.map(e=>{if(e instanceof u.AddSignature)return e.toString();if(e instanceof Buffer)return e.toString("hex");if(typeof e=="number")return"num_"+e.toString();throw new Error("Invalid unlock script")}),k=await this.connector.send(r.spend,{script:t.toString("hex"),scriptAddress:o,witness:b,toAddress:s,fee:c,unlockScript:h,nSequence:g});return await n.string().required().validate(k)}walletConfig(){throw new Error("Method not supported")}async getAddress(){const t=await this.connector.send(r.getAddress);return await n.string().required().validate(t)}async sign(t){const o=await this.connector.send(r.sign,{hexMsg:t});return await n.string().required().validate(o)}}exports.BitcoinActions=r;exports.BitcoinRpcProvider=d;
