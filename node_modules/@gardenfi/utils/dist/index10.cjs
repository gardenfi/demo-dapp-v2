"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const j=require("./index15.cjs"),k=require("./index21.cjs"),g=require("./index27.cjs"),I=require("./index28.cjs"),v=require("./index31.cjs"),M=require("./index30.cjs"),O=require("./index14.cjs"),P=require("./index20.cjs"),q=require("./index23.cjs"),S=require("./index25.cjs");async function $(n,{confirmations:o=1,hash:f,onReplaced:B,pollingInterval:h=n.pollingInterval,retryCount:w=6,retryDelay:N=({count:p})=>~~(1<<p)*200,timeout:R=18e4}){const p=M.stringify(["waitForTransactionReceipt",n.uid,f]);let c,a,e,i=!1;return new Promise((m,y)=>{R&&setTimeout(()=>y(new k.WaitForTransactionReceiptTimeoutError({hash:f})),R);const F=I.observe(p,{onReplaced:B,resolve:m,reject:y},t=>{const A=g.getAction(n,S.watchBlockNumber,"watchBlockNumber")({emitMissed:!0,emitOnBegin:!0,poll:!0,pollingInterval:h,async onBlockNumber(E){const u=b=>{A(),b(),F()};let l=E;if(!i)try{if(e){if(o>1&&(!e.blockNumber||l-e.blockNumber+1n<o))return;u(()=>t.resolve(e));return}if(c||(i=!0,await v.withRetry(async()=>{c=await g.getAction(n,P.getTransaction,"getTransaction")({hash:f}),c.blockNumber&&(l=c.blockNumber)},{delay:N,retryCount:w}),i=!1),e=await g.getAction(n,q.getTransactionReceipt,"getTransactionReceipt")({hash:f}),o>1&&(!e.blockNumber||l-e.blockNumber+1n<o))return;u(()=>t.resolve(e))}catch(b){if(b instanceof k.TransactionNotFoundError||b instanceof k.TransactionReceiptNotFoundError){if(!c){i=!1;return}try{a=c,i=!0;const T=await v.withRetry(()=>g.getAction(n,O.getBlock,"getBlock")({blockNumber:l,includeTransactions:!0}),{delay:N,retryCount:w,shouldRetry:({error:s})=>s instanceof j.BlockNotFoundError});i=!1;const r=T.transactions.find(({from:s,nonce:_})=>s===a.from&&_===a.nonce);if(!r||(e=await g.getAction(n,q.getTransactionReceipt,"getTransactionReceipt")({hash:r.hash}),o>1&&(!e.blockNumber||l-e.blockNumber+1n<o)))return;let d="replaced";r.to===a.to&&r.value===a.value?d="repriced":r.from===r.to&&r.value===0n&&(d="cancelled"),u(()=>{var s;(s=t.onReplaced)==null||s.call(t,{reason:d,replacedTransaction:a,transaction:r,transactionReceipt:e}),t.resolve(e)})}catch(T){u(()=>t.reject(T))}}else u(()=>t.reject(b))}}})})})}exports.waitForTransactionReceipt=$;
